#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Validating commit message..."

# Read the commit message
commit_message=$(cat "$1")

# Check if commit message follows conventional commit format
# Allowed types: feat, fix, docs, style, refactor, test, chore, ci, security
conventional_pattern="^(feat|fix|docs|style|refactor|test|chore|ci|security)(\(.+\))?!?: .+"

if echo "$commit_message" | grep -qE "$conventional_pattern"; then
  echo "âœ… Commit message follows conventional commit format"
elif echo "$commit_message" | grep -qE "^(ğŸš€|ğŸ”§|ğŸ§ª|ğŸ›¡ï¸|ğŸ“š|ğŸ¨|â™»ï¸|ğŸš§|âš¡|ğŸ›|âœ¨|ğŸ’„|ğŸ”’|ğŸ“¦|ğŸ·ï¸|ğŸ”¥|ğŸ’š|ğŸ‘·|ğŸ“ˆ|ğŸ©¹|ğŸ¯|ğŸš¨|ğŸ™ˆ|ğŸ“|ğŸ”€|ğŸ“Œ|â¬†ï¸|â¬‡ï¸|ğŸ“¦|ğŸ‘½|ğŸšš|ğŸ“„|ğŸ’¡|ğŸ»|ğŸ’¬|ğŸ—ƒï¸|ğŸ”Š|ğŸ”‡|ğŸ“±|ğŸ¤¡|ğŸ¥š|ğŸ™ˆ|ğŸ“¸|âš—ï¸|ğŸ”|ğŸ·ï¸|ğŸŒ|â™¿|ğŸ’¬|ğŸ—ƒï¸|ğŸ”ˆ|ğŸ”Š|ğŸ“±|ğŸ¤¡|ğŸ¥š|ğŸ™ˆ|ğŸ“¸|âš—ï¸|ğŸ”|ğŸ·ï¸|ğŸŒ|â™¿|ğŸ’¬|ğŸ—ƒï¸|ğŸ“±|ğŸ¤¡|ğŸ¥š|ğŸ™ˆ|ğŸ“¸|âš—ï¸|ğŸ”|ğŸ·ï¸|ğŸŒ|â™¿)"; then
  echo "âœ… Commit message uses emoji convention"
elif echo "$commit_message" | grep -qE "^(WIP|HOTFIX|BREAKING|Merge|Revert)"; then
  echo "âœ… Commit message uses special convention"
else
  echo "âŒ Commit message should follow one of these formats:"
  echo ""
  echo "Conventional Commits:"
  echo "  feat: add new feature"
  echo "  fix: bug fix"
  echo "  docs: documentation changes"
  echo "  style: formatting changes"
  echo "  refactor: code refactoring"
  echo "  test: adding or updating tests"
  echo "  chore: maintenance tasks"
  echo "  ci: CI/CD changes"
  echo "  security: security improvements"
  echo ""
  echo "Or Emoji Commits:"
  echo "  âœ¨ feat: new feature"
  echo "  ğŸ› fix: bug fix"
  echo "  ğŸ“š docs: documentation"
  echo "  ğŸ”§ chore: maintenance"
  echo ""
  echo "Current message: $commit_message"
  exit 1
fi

echo "âœ… Commit message validation passed!"